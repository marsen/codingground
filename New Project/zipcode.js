var _ZipCode = new ZipCode();

$(function () {

    _ZipCode.GetZipCodeData();

    $("#cityUl").hide();
    $("#townDiv").hide();
    $("#townUl").hide();

    _ZipCode.SetEvent();

});

function ZipCode() {
    this.SetEvent = setEvent;
    this.GetZipCodeData = getZipCodeData;

    var data = [];

    function setEvent() {
    
        //顯示縣市下拉選單
        $("#cityBt").click(function () {
            $("#cityUl").show();
        });

        //顯示縣市下拉選單
        $("#townBt").click(function () {
            $("#townUl").show();
        });

        //設定下拉選單ul Hover事件
        $(".codeUl").hover(function () {
        }, function () {
            $(this).hide();
        });

        //設定下拉選單項目Hover事件(設定背景顏色)
        $(".codeUl").find("li").hover(function () {
            $(this).css("background-color", "#f2f2f2");
        }, function () {
            $(this).css("background-color", "#ffffff");
        });

        //設定縣市下拉選單項目Click事件(顯示鄉鎮選單or 填入區碼)
        $("#cityUl").find("li").click(function () {

            //嘗試取得縣市區碼
            var townId = $(this).attr("townId");

            //取得縣市名稱並設定到TextView
            var cityName = $(this).text();
            var nowCityName = $("#cityText").val();
            if (cityName === nowCityName) {
                return;
            }
            else {
                $("#cityText").val(cityName);
                $("#townText").val("鄉鎮市區");
            }
            
            //如果沒有縣市區碼則代表要選鄉鎮
            if (townId === "undefinedz") {
                $("#zipCode").val("");

                var towns = data[cityName];
            
                //設定鄉鎮下拉選單
                $("#townUl").html("");
                var townLis = "";
                var template = "<li townId={townId}>{townName}</li>";
                $.each(towns, function (k, v) {
                    townLis += template.replace(/\{townId}/g, v).replace(/\{townName}/g, k);
                });

                $("#townUl").html(townLis);

                //設定鄉鎮下拉選單項目Hover事件(設定背景顏色)
                $("#townUl").find("li").hover(function () {
                    $(this).css("background-color", "#f2f2f2");
                }, function () {
                    $(this).css("background-color", "#ffffff");
                });

                //設定鄉鎮下拉選單項目Click事件(填入區碼)
                $("#townUl").find("li").click(function () {

                    //取得鄉鎮名稱並設定到TextView
                    var townName = $(this).text();
                    $("#townText").val(townName);

                    //取得區碼並設定到TextView
                    var townId = $(this).attr("townId");
                    $("#zipCode").val(townId);
                });

                $("#townDiv").show();
            }
            else {
                $("#townDiv").hide();

                 //區碼設定到TextView
                $("#zipCode").val(townId);
            }
        });

    };

    function getZipCodeData() {        
        data = {
            '臺北市':
            {  
                '中正區' : '100', '大同區' : '103', '中山區' : '104', '松山區' : '105', '大安區' : '106',
                '萬華區' : '108', '信義區' : '110', '士林區' : '111', '北投區' : '112', '內湖區' : '114',
                '南港區' : '115', '文山區' : '116'
            },
             '基隆市':
            {	    
                '仁愛區':'200', '信義區':'201', '中正區':'202', '中山區':'203', '安樂區':'204',
                '暖暖區':'205', '七堵區':'206'
            },
             '新北市':
            {  
                '萬里區':'207',  '金山區':'208',  '板橋區':'220',  '汐止區':'221',  '深坑區':'222', 
                '石碇區':'223',  '瑞芳區':'224',  '平溪區':'226',  '雙溪區':'227',  '貢寮區':'228', 
                '新店區':'231',  '坪林區':'232',  '烏來區':'233',  '永和區':'234',  '中和區':'235', 
                '土城區':'236',  '三峽區':'237',  '樹林區':'238',  '鶯歌區':'239',  '三重區':'241', 
                '新莊區':'242',  '泰山區':'243',  '林口區':'244',  '蘆洲區':'247',  '五股區':'248', 
                '八里區':'249',  '淡水區':'251',  '三芝區':'252',  '石門區':'253' 
            },
             '宜蘭縣':
            {
                '宜  蘭':'260', '頭  城':'261', '礁  溪':'262', '壯  圍':'263', '員  山':'264',
                '羅  東':'265', '三  星':'266', '大  同':'267', '五  結':'268', '冬  山':'269',
                '蘇  澳':'270', '南  澳':'272', '釣魚台列嶼':  '290' 
            },
            '新竹市':  '300', 
            '新竹縣':
            {
                '竹  北':'302',   '湖  口':'303',   '新  豐':'304',   '新  埔':'305',   '關  西':'306',  
                '芎  林':'307',   '寶  山':'308',   '竹  東':'310',   '五  峰':'311',   '橫  山':'312',  
                '尖  石':'313',   '北  埔':'314',   '峨  眉':'315'  
            },
            '桃園縣':
            {
                '中  壢':'320',  '平  鎮':'324',  '龍  潭':'325',  '楊  梅':'326',  '新  屋':'327', 
                '觀  音':'328',  '桃  園':'330',  '龜  山':'333',  '八  德':'334',  '大  溪':'335', 
                '復  興':'336',  '大  園':'337',  '蘆  竹':'338'
            },
            '苗栗縣':
            {
                '竹  南':'350',   '頭  份':'351',   '三  灣':'352',   '南  庄':'353',   '獅  潭':'354',  
                '後  龍':'356',   '通  霄':'357',   '苑  裡':'358',   '苗  栗':'360',   '造  橋':'361',  
                '頭  屋':'362',   '公  館':'363',   '大  湖':'364',   '泰  安':'365',   '銅  鑼':'366',  
                '三  義':'367',   '西  湖':'368',   '卓  蘭':'369'
            },
            '臺中市':
            {
                '中  區':'400',   '東  區':'401',   '南  區':'402',   '西  區':'403',   '北  區':'404',  
                '北屯區':'406',   '西屯區':'407',   '南屯區':'408',   '太平區':'411',   '大里區':'412',  
                '霧峰區':'413',   '烏日區':'414',   '豐原區':'420',   '后里區':'421',   '石岡區':'422',  
                '東勢區':'423',   '和平區':'424',   '新社區':'426',   '潭子區':'427',   '大雅區':'428',  
                '神岡區':'429',   '大肚區':'432',   '沙鹿區':'433',   '龍井區':'434',   '梧棲區':'435',  
                '清水區':'436',   '大甲區':'437',   '外埔區':'438',   '大安區':'439', 
            },
            '彰化縣':
            {
                '彰  化':'500',   '芬  園':'502',   '花  壇':'503',   '秀  水':'504',   '鹿  港':'505',  
                '福  興':'506',   '線  西':'507',   '和  美':'508',   '伸  港':'509',   '員  林':'510',  
                '社  頭':'511',   '永  靖':'512',   '埔  心':'513',   '溪  湖':'514',   '大  村':'515',  
                '埔  鹽':'516',   '田  中':'520',   '北  斗':'521',   '田  尾':'522',   '埤  頭':'523',  
                '溪  州':'524',   '竹  塘':'525',   '二  林':'526',   '大  城':'527',   '芳  苑':'528',  
                '二  水':'530'
            },
            '南投縣':
            {
                '南  投':'540',  '中  寮':'541',  '草  屯':'542',  '國  姓':'544',  '埔  里':'545', 
                '仁  愛':'546',  '名  間':'551',  '集  集':'552',  '水  里':'553',  '魚  池':'555', 
                '信  義':'556',  '竹  山':'557',  '鹿  谷':'558'
            },
            '嘉義市':'600',
            '嘉義縣':
            {
                '番  路':'602',   '梅  山':'603',   '竹  崎':'604',   '阿里山':'605',   '中  埔':'606',  
                '大  埔':'607',   '水  上':'608',   '鹿  草':'611',   '太  保':'612',   '朴  子':'613',  
                '東  石':'614',   '六  腳':'615',   '新  港':'616',   '民  雄':'621',   '大  林':'622', 
                '溪  口':'623',   '義  竹':'624',   '布  袋':'625'
            },
            '雲林縣':
            {
                '斗  南':'630', '大  埤':'631', '虎  尾':'632', '土  庫':'633', '褒  忠':'634',
                '東  勢':'635', '臺  西':'636', '崙  背':'637', '麥  寮':'638', '斗  六':'640',
                '林  內':'643', '古  坑':'646', '莿  桐':'647', '西  螺':'648', '二  崙':'649',
                '北  港':'651', '水  林':'652', '口  湖':'653', '四  湖':'654', '元  長':'655'
            },
            '臺南市':
            {
                '中西區':'700',  '東  區':'701',  '南  區':'702',  '北  區':'704',  '安平區':'708', 
                '安南區':'709',  '永康區':'710',  '歸仁區':'711',  '新化區':'712',  '左鎮區':'713', 
                '玉井區':'714',  '楠西區':'715',  '南化區':'716',  '仁德區':'717',  '關廟區':'718', 
                '龍崎區':'719',  '官田區':'720',  '麻豆區':'721',  '佳里區':'722',  '西港區':'723', 
                '七股區':'724',  '將軍區':'725',  '學甲區':'726',  '北門區':'727',  '新營區':'730', 
                '後壁區':'731',  '白河區':'732',  '東山區':'733',  '六甲區':'734',  '下營區':'735', 
                '柳營區':'736',  '鹽水區':'737',  '善化區':'741',  '大內區':'742',  '山上區':'743', 
                '新市區':'744',  '安定區':'745'
            },
            '高雄市':
            {
                '新興區':'800',    '前金區':'801',    '苓雅區':'802',	  '鹽埕區':'803',    '鼓山區':'804',  
                '旗津區':'805',    '前鎮區':'806',    '三民區':'807',    '楠梓區':'811',    '小港區':'812',  
                '左營區':'813',    '仁武區':'814',    '大社區':'815',    '岡山區':'820',    '路竹區':'821',  
                '阿蓮區':'822',    '田寮區':'823',    '燕巢區':'824',    '橋頭區':'825',    '梓官區':'826',  
                '彌陀區':'827',    '永安區':'828',    '湖內區':'829',    '鳳山區':'830',    '大寮區':'831',  
                '林園區':'832',    '鳥松區':'833',    '大樹區':'840',    '旗山區':'842',    '美濃區':'843',  
                '六龜區':'844',    '內門區':'845',    '杉林區':'846',    '甲仙區':'847',    '桃源區':'848',  
                '那瑪夏區':'849',  '茂林區':'851',    '茄萣區':'852' 
            },
            '南海諸島':
            {
                '東  沙':' 817 ' ,  '南  沙':' 819 '
            },
            '澎湖縣':
            {
                '馬  公':'880',  '西  嶼':'881',  '望  安':'882',  '七  美':'883',  '白  沙':'884',
                '湖  西':'885'
            },
            '屏東縣':
            {
                '屏  東':'900',   '三地門':'901',   '霧  臺':'902',   '瑪  家':'903',   '九  如':'904',  
                '里  港':'905',   '高  樹':'906',   '鹽  埔':'907',   '長  治':'908',   '麟  洛':'909',  
                '竹  田':'911',   '內  埔':'912',   '萬  丹':'913',   '潮  州':'920',   '泰  武':'921',   
                '來  義':'922',   '萬  巒':'923',   '崁  頂':'924',   '新  埤':'925',   '南  州':'926',  
                '林  邊':'927',   '東  港':'928',   '琉  球':'929',   '佳  冬':'931',   '新  園':'932',  
                '枋  寮':'940',   '枋  山':'941',   '春  日':'942',   '獅  子':'943',   '車  城':'944',  
                '牡  丹':'945',   '恆  春':'946',   '滿  州':'947'
            },
            '臺東縣':
            {
                '臺  東':'950', '綠  島':'951', '蘭  嶼':'952', '延  平':'953', '卑  南':'954',
                '鹿  野':'955', '關  山':'956', '海  端':'957', '池  上':'958', '東  河':'959',
                '成  功':'961', '長  濱':'962', '太麻里':'963', '金  峰':'964', '大  武':'965',
                '達  仁':'966'
            },
            '花蓮縣':
            {
                '花  蓮':'970', '新  城':'971', '秀  林':'972', '吉  安':'973', '壽  豐':'974',
                '鳳  林':'975', '光  復':'976', '豐  濱':'977', '瑞  穗':'978', '萬  榮':'979',
                '玉  里':'981', '卓  溪':'982', '富  里':'983'
            },
            '金門縣':
            {
                '金  沙':'890', '金  湖':'891', '金  寧':'892', '金  城':'893', '烈  嶼':'894',
                '烏  坵':'896'
            },
            '連江縣':
            {
                '南  竿':'209', '北  竿':'210', '莒  光':'211', '東  引':'212'
            }
        };
    };
};
